<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Push and go; easy hosting in gh-pages</title>
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="/bijectiv/resources/css/reset.css" />
        <link rel="stylesheet" href="/bijectiv/resources/css/site.css" />
	    <link rel="stylesheet" href="/bijectiv/resources/css/syntax.css" />
        <script type="text/javascript" src="/bijectiv/resources/scripts/jquery-2.0.3.min.js"></script>
        <script type="text/javascript" src="/bijectiv/resources/scripts/bijectiv.js"></script>
    </head>
    <body onLoad="bijectiv()">
        <div id="all">
            <div id="mast">
                <div id="head">
                    <a href="/bijectiv/"><img id="f5" src="/bijectiv/resources/images/f5.png" alt="Hack F5 Pray logo" /></a>
                    <h1>Hack.F5.Pray - the bijectiv blog - code from the trenches (the mouth of a cow)</h1>
                    <img id="qm" class="right" src="/bijectiv/resources/images/info.png" alt="About the bijectiv blog" />
                </div>
	        </div>
	        <div id="main">

		          <div class="post">
    <div class="post-head">
        <img src="/bijectiv/resources/images/ring.png" />
        <h2><a href="/bijectiv/infrastructure/2014/03/27/push-and-go.html">Push and go; easy hosting in gh-pages</a></h2>
        <span class="right post-head-date">27 Mar 2014</span>
    </div>
    <div class="post-body"><div class="vertical-line right"></div><h3>Preamble</h3>

<p>Four days in and I&#39;m really excited by the <a href="http://pages.github.com/">github pages</a> / <a href="http://jekyllrb.com">jekyll</a> static site generator combination. I&#39;m not so sure about the all-in-one solution of uploading the unparsed jekyll site because, being a programmer, I have a natural aversion to committing something I&#39;m not happy with and it requires a commit to see how new content gets rendered. However, working locally with jekyll running in the background is by far the best way to develop a small site that I&#39;ve come across. Databases rule for transactional integrity, but it is starting to become clear that the price one pays for that integrity is really quite high: for tiny data volumes go flat files and a parser, for huge data volumes go hadoop, databases occupy the middle ground.</p>

<p>I think that next time I work on a web project I may well use jekyll to prototype the layout and javascript because it gives such immediate feedback. The template syntax is fairly similar to ASP.NET, so once you&#39;ve got the basic shell working with jekyll then translating that back to ASP is going to be straightforward (this theme originally belonged to the beginnings of an MVC Razor blog).</p>

<h3>Developing with github pages and jekyll</h3>

<p>Something I realised very quickly was that when hosting in <a href="http://pages.github.com/">github pages</a> and using <a href="http://jekyllrb.com">jekyll</a> locally to build the site it is critical that the <em>proto site</em> (i.e. the thing that jekyll actually builds into your site) gets version controlled. Why? well if you mess this up then you will have no way of going back from the built site to its definition. To this end I now have two branches in the github project that are dedicated to the blog:</p>

<ul>
<li><code>gh-pages</code> and;</li>
<li><code>gh-pages-proto</code></li>
</ul>

<p>The branch <code>gh-pages</code> is the special branch that github provides for hosting sites and <code>gh-pages-proto</code> is the branch that contains the code that jekyll builds into <code>gh-pages</code>. The suffix <em>proto</em> means first; giving <code>gh-pages-proto</code> the meaning of the entity that brought about <code>gh-pages</code>.</p>

<p>To work with this setup, at the end of each session I need to:</p>

<ul>
<li>Build the site.</li>
<li>Merge the newly built site over the old one.</li>
<li>Stage, commit and push those changes to <code>gh-pages</code>.</li>
<li>Remove junk I don&#39;t want version controlled from <code>gh-pages-proto</code>.</li>
<li>Stage, commit and push the code changes to <code>gh-pages-proto</code>.</li>
</ul>

<p>This obviously sounds like a total pain to do by hand, so that is why it needs to be automated. The following bash script does this (<code>bash</code> is so much better than Windows <code>batch</code>). To run it you will need to <a href="http://stackoverflow.com/questions/5343068/is-there-a-way-to-skip-password-typing-when-using-https-github">cache your credentials with git</a>: Giri Alwar&#39;s answer works best for me, but my credentials are secure by virtue of their geography, on a public machine this might not work for you.</p>

<h3>Push to <code>gh-pages</code> and <code>gh-pages-proto</code></h3>

<div class="highlight"><pre><code class="bash"><span class="c">#!/bin/bash</span>

<span class="c"># Remember where we are so we can return there at the end of the script</span>
<span class="nb">pushd</span> ./

<span class="c"># 1. Define the directories that contain the two branches.</span>
<span class="c"># The directory that contains the gh-pages branch.</span>
<span class="nv">ghpages</span><span class="o">=</span><span class="s2">&quot;/home/themouthofacow/Documents/bijectiv/gh-pages/&quot;</span>
<span class="c"># The directory that contains the branch containing the code that gets built by jekyll.</span>
<span class="nv">ghpagesproto</span><span class="o">=</span><span class="s2">&quot;/home/themouthofacow/Documents/bijectiv/gh-pages-proto/&quot;</span>

<span class="c"># 2. Build the site using jekyll.</span>
<span class="nb">cd</span> <span class="nv">$ghpagesproto</span>
jekyll build

<span class="c"># 3. Delete everything from gh-pages directory except for the git repository and the ignore file.</span>
<span class="nb">cd</span> <span class="nv">$ghpages</span>
<span class="nb">shopt</span> -s extglob
rm !<span class="o">(</span>.git<span class="p">|</span>.gitignore<span class="o">)</span> -r

<span class="c"># 4. Copy the freshly built site into the gh-pages directory.</span>
cp <span class="nv">$ghpagesproto</span>/_site/* ./ -r
rm <span class="nv">$ghpagesproto</span>/_site -r

<span class="c"># 5. Add everything - this is the clever bit; because git stores hashes of all of the files in the</span>
<span class="c">#    local repository adding everything in fact: removes files that no longer exist; adds the new </span>
<span class="c">#    ones and; updates the ones that have changed. Anything that hasn&#39;t changed is untouched, so you</span>
<span class="c">#    get a perfect incremental commit!</span>
git add -A .
git commit -a -m <span class="s1">&#39;blog updated --tmoac&#39;</span>
git push

<span class="c"># 6. Commit the code that gets built by jekyll.</span>
<span class="nb">cd</span> <span class="nv">$ghpagesproto</span>
git add -A .
git commit -a -m <span class="s1">&#39;site updated --tmoac&#39;</span>
git push

<span class="c"># Return to the original location.</span>
<span class="nb">popd</span>
</code></pre></div>
</div>
    <div class="post-foot">
        
	        <div class="post-tag"><a href="/bijectiv/tag/blog">blog</a></div>
        
	        <div class="post-tag"><a href="/bijectiv/tag/infrastructure">infrastructure</a></div>
        
	        <div class="post-tag"><a href="/bijectiv/tag/git">git</a></div>
        
    </div>
        
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'bijectiv';
                var disqus_identifier = '/infrastructure/2014/03/27/push-and-go.html';
                var disqus_title = 'Push and go; easy hosting in gh-pages';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();

            </script>
       
</div>


	            </div>
            <div id="foot">
	            <p>Rebuild All succeeded - 2014 - London - UK | <a href="http://github.com/TheMouthOfACow">http://github.com/TheMouthOfACow</a> | <a href="https://twitter.com/TheMouthOfACow">https://twitter.com/TheMouthOfACow</a> | <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0 licence</a>
	            </p>
            </div>
            <div id="overlay"></div>
            <!--<div id="the-world-is-yours">
                <iframe src="/bijectiv/moon.html" width="800" height="800"></iframe> 
            </div>-->
	        <div id="about">
		        <img id="about-close" src="/bijectiv/resources/images/ring.png" />

                <h1>About</h1>
                <div>
                    <img class="right" src="https://download-codeplex.sec.s-msft.com/download/Avatar.ashx?DownloadId=815244" alt="Brian Tyler" />
                    <p>This site documents how the <a href="https://github.com/TheMouthOfACow/bijectiv" />bijectiv</a> object-to-object .NET mapping library got/is getting built.<p>
                    <p>Bijectiv is (being) written by Brian Tyler in his (very limited, see small child to the right) spare time; by day I'm a technical architect developer at Aon's global headquarters in London, the rest of the time I do <a href="http://kozuetyler.wordpress.com/">family stuff</a>.</p>
                    <p>The purpose of the library is to provide an industrial strength, open source mapper for .NET and the reason for the blog is to describe why it is built the way it is and to act as a resource for other developers who are interested in how a library could be designed and coded.</p>
                    <p>The blog is written using <a href="http://jekyllrb.com/">Jekyll</a> on Mint Linux (apparently that's the way the cool kids do it these days). The library is written in Visual Studio 2013 Ultimate on Windows 8.1 and runs portably in the .NET 4.0 runtime.</p>
                    <h2>Copyleft</h2>
                    <p>You do not need permission to share anything I have written on this site or to reuse my images even for commercial purposes. They are all published under a <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0) licence</a>. A mention of the licence however is compulsory and a link back to the original is a nice courtesy.</p>
                    <p>... this comes with an observation: cloning posts wholesale doesn't create value it just just increases universal entropy.</p>
                    <h2>More</h2>
                    <br />
                    <div class="right" style="margin-right:5px;"><a href="http://stackoverflow.com/users/323316/the-mouth-of-a-cow">
<img src="http://stackoverflow.com/users/flair/323316.png?theme=clean" width="208" height="58" alt="profile for The Mouth of a Cow at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for The Mouth of a Cow at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
</a>
</div>
                    <p>I love <a href="http://stackoverflow.com">stackoverflow</a>, but I don't answer questions much there anymore because people vote for <a href="http://stackoverflow.com/questions/5598703/c-const-usage-explanation/5598730#5598730">regurgitating trivia</a> not <a href="http://stackoverflow.com/questions/10698915/invalid-type-owner-for-dynamicmethod-error-when-sorting-an-interface/13790392#13790392">hardcore software engineering</a>.</p>
                <p>I've written an open source visual studio extension called <a href="https://xamlr.codeplex.com/">Xamlr</a> that formats XAML files. If you write XAML, you need this!</p>
                </div>
	        </div>
	        <script type="text/javascript" >
	            $( "#about-close" ).click(function() {
		            $( "#overlay" ).hide();
		            $( "#about" ).hide();
                    $( "#the-world-is-yours" ).hide();
	            });

                $( "#the-world-is-yours" ).click(function() {
		            $( "#overlay" ).hide();
		            $( "#about" ).hide();
                    $( "#the-world-is-yours" ).hide();
	            });
	
	            $( "#overlay" ).click(function() {
		            $( "#overlay" ).hide();
		            $( "#about" ).hide();
                    $( "#the-world-is-yours" ).hide();
	            });
	
	            $(document).keyup(function(e) {
	              if (e.keyCode == 27) {
		            $( "#overlay" ).hide();
		            $( "#about" ).hide();
                    $( "#the-world-is-yours" ).hide();
	            }   // esc
	            });
	
	            $( "#qm" ).click(function() {
		            $( "#overlay" ).show();
		            $( "#about" ).show();
                    $( "#the-world-is-yours" ).hide();
	            });

                $( "#easter" ).click(function() {
		            $( "#overlay" ).show();
		            $( "#about" ).hide();
                    $( "#the-world-is-yours" ).show();
	            });
	        </script>
        </div>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-5245850-6', 'themouthofacow.github.io');
          ga('send', 'pageview');

        </script>
    </body>
</html>
